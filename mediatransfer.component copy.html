<div class="transfer-container">
  <h1>Media Transfer Request</h1>
 <!-- Initial Button (File Input) -->
  <div *ngIf="!fileSelected && !showEmailForm" class="container text-center">
   <label for="file-upload" class="btn btn-primary btn-circle">
     Upload Files
     <input type="file" id="file-upload" class="hidden-file-input" (change)="onFileSelected($event)" multiple>
   </label>
   
   <!-- My Transfers Button -->
   <div class="my-transfers-section" *ngIf="recipientEmails.length > 0">
     <button class="btn btn-secondary my-transfers-btn" (click)="toggleMyTransfers()">
       {{ showMyTransfers ? 'Hide My Transfers' : 'View My Transfers' }}
     </button>
   </div>
 </div>

 <!-- Email Drafting Screen -->
 <div *ngIf="fileSelected && showEmailForm" class="email-drafting-screen">
   <div class="container-full">
     <h1 class="container-header">Select Files to Send to Recipient</h1>
     <div class="drafting-container">
       <div class="file-column">
         <div class="file-header">
         <h4>{{selectedFiles.length}} {{selectedFiles.length == 1 ? 'File' : 'Files'}}</h4>
         <label class="add-files-btn">
           +
           <input type="file" class="hidden-file-input" 
                  (change)="addFiles($event)" multiple>
         </label>
       </div>
         <div class="file-list">
           <div class="file-item" *ngFor="let file of selectedFiles; let i = index">
             <span>{{ file.name }}</span>
             <button class="remove-file" (click)="removeFile(i)">×</button>
           </div>
         </div>
         
       </div>

       <div class="separator-column"></div>

       <div class="email-column">
         <form (ngSubmit)="sendEmail()" class="email-form">
          <div class="email-scrollable-content">
           <div class="form-group">
             <input
               type="email"
               class="form-control"
               id="sender-email"
               [(ngModel)]="sender"
               name="senderEmail"
               placeholder="Enter Your Email"
             />
         </div>
         <div class="form-group">
          <!-- Show chip-container ONLY if there are emails -->
          <div class="chip-container" *ngIf="recipientEmails.length > 0">
            <span class="chip" *ngFor="let email of recipientEmails">
              {{ email }}
              <span class="remove-chip" (click)="removeEmail(email)">×</span>
            </span>
          </div>
          <!-- Will enter the email chip if they press enter (keyup.enter) or click away (blur) -->
          <input
            type="text"
            id="recipient-email"
            name="recipientEmail"
            class="form-control email-input-chip"
            placeholder="Recipients' emails"
            [(ngModel)]="currentEmail"
            (keyup.enter)="addEmail($event)"
            (blur)="addEmailOnBlur()"
          />
        </div>
           
           <div class="form-group">
             <input
               type="text"
               class="form-control"
               id="subject"
               [(ngModel)]="subject"
               name="subject"
               placeholder="Subject"
             />
           </div>
           <div class="form-group">
             <textarea
               class="form-control"
               id="message"
               [(ngModel)]="body"
               name="message"
               rows="5"
               placeholder="Message"
             ></textarea>
           </div>
          </div>
           <div class="send-button-container">
            <!-- This is that it won't automatically try to uploadFile when entering emails-->
            <form (ngSubmit)="uploadFile()" #emailForm="ngForm" novalidate>
              <div class="send-button-container">
                <button type="button" class="btn btn-primary" (click)="uploadFile()">Send Email</button>
              </div>
            </form>
           </div>
         </form>
       </div>
     </div>
   </div>
 </div>
 
<!-- Success/Error Messages (visible even before file selection) -->
<div *ngIf="successMessage" class="success-message">
 {{ successMessage }}
</div>
<div *ngIf="errorMessage" class="error-message">
 {{ errorMessage }}
</div>
<div *ngIf="warningMessage" class="warning-message">
 {{ warningMessage }}
</div>

<!-- My Transfers List -->
<div *ngIf="showMyTransfers" class="my-transfers-list">
  <h3>My Transfers</h3>
  <div *ngIf="myTransfers.length === 0" class="no-transfers">
    No transfers found for {{ recipientEmails[0] }}
  </div>
  <div *ngIf="myTransfers.length > 0" class="transfers-grid">
    <div *ngFor="let file of myTransfers" class="transfer-item">
      <div class="file-info">
        <span class="file-name">{{ file }}</span>
      </div>
      <div class="file-actions">
        <button class="btn btn-sm btn-outline-primary" 
                (click)="downloadFile(recipientEmails[0], file)">
          Download
        </button>
      </div>
    </div>
  </div>
</div>

<progress-spinner [isLoading]="isUploading" [progress]="uploadProgress"></progress-spinner>
</div>